FROM ubuntu:latest
ENV LANG=C.UTF-8 LC_ALL=C.UTF-8
ENV PATH=/opt/conda/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
RUN apt-get update --fix-missing # buildkit
RUN apt-get install -y wget bzip2 ca-certificates libglib2.0-0 libxext6 libsm6 libxrender1 curl grep sed dpkg git mercurial subversion build-essential # buildkit

# ANACONDA
RUN wget https://repo.anaconda.com/archive/Anaconda3-2022.05-Linux-x86_64.sh -O ~/anaconda.sh && /bin/bash ~/anaconda.sh -b -p /opt/conda && rm ~/anaconda.sh && ln -s /opt/conda/etc/profile.d/conda.sh /etc/profile.d/conda.sh && echo ". /opt/conda/etc/profile.d/conda.sh" >> ~/.bashrc && echo "conda activate base" >> ~/.bashrc # buildkit
RUN conda install -c anaconda scikit-learn -y # buildkit
RUN pip install group-lasso # buildkit

# TEXLIVE

RUN echo "Using chinese apt mirror, because otherwise I cannot build this image on my PC." && sed -i 's/archive\.ubuntu\.com/mirrors.ustc.edu.cn/g' /etc/apt/sources.list && echo "/etc/apt/sources.list is now:" && cat /etc/apt/sources.list && echo "Performing initial clean-up and updates." && apt-get -y update && apt-get -y --fix-missing --no-install-recommends install && apt-get -y --with-new-pkgs --no-install-recommends upgrade && echo "Preventing doc and man pages from being installed." && printf 'path-exclude /usr/share/doc/*\npath-include /usr/share/doc/*/copyright\npath-exclude /usr/share/man/*\npath-exclude /usr/share/groff/*\npath-exclude /usr/share/info/*\npath-exclude /usr/share/lintian/*\npath-exclude /usr/share/linda/*\npath-exclude=/usr/share/locale/*' > /etc/dpkg/dpkg.cfg.d/01_nodoc && rm -rf /usr/share/groff/* /usr/share/info/* && rm -rf /usr/share/lintian/* /usr/share/linda/* /var/cache/man/* && rm -rf /usr/share/man && mkdir -p /usr/share/man && find /usr/share/doc -depth -type f ! -name copyright -delete && find /usr/share/doc -type f -name "*.pdf" -delete && find /usr/share/doc -type f -name "*.gz" -delete && find /usr/share/doc -type f -name "*.tex" -delete && (find /usr/share/doc -type d -empty -delete || true) && mkdir -p /usr/share/doc && mkdir -p /usr/share/info && echo "Installing utilities." && apt-get install -f -y --no-install-recommends apt-utils && echo "Get and update certificates for mscorefonts." && apt-get install -f -y --no-install-recommends ca-certificates && update-ca-certificates && echo "Installing utilities and nice fonts for Chinese and others." && apt-get install -f -y --no-install-recommends curl emacs-intl-fonts fontconfig fonts-arphic-bkai00mp fonts-arphic-bsmi00lp fonts-arphic-gbsn00lp fonts-arphic-gkai00mp fonts-arphic-ukai fonts-arphic-uming fonts-dejavu fonts-dejavu-core fonts-dejavu-extra fonts-droid-fallback fonts-guru fonts-guru-extra fonts-liberation fonts-noto-cjk fonts-opensymbol fonts-roboto fonts-roboto-hinted fonts-stix fonts-symbola fonts-texgyre fonts-unfonts-core ttf-wqy-microhei ttf-wqy-zenhei xfonts-intl-chinese xfonts-intl-chinese-big xfonts-wqy && echo "Installing microsoft core fonts." && echo "ttf-mscorefonts-installer msttcorefonts/accepted-mscorefonts-eula select true" | debconf-set-selections && echo "ttf-mscorefonts-installer msttcorefonts/present-mscorefonts-eula note" | debconf-set-selections && curl --output "/tmp/ttf-mscorefonts-installer.deb" "http://ftp.de.debian.org/debian/pool/contrib/m/msttcorefonts/ttf-mscorefonts-installer_3.7_all.deb" && (apt install -f -y --no-install-recommends "/tmp/ttf-mscorefonts-installer.deb" || true) && rm -f "/tmp/ttf-mscorefonts-installer.deb" && curl --output "/root/mscorefonts-eula" "http://corefonts.sourceforge.net/eula.htm" && echo "Installing TeX Live and ghostscript and other tools." && apt-get install -f -y --no-install-recommends biber cm-super dvipng fonts-dejavu fonts-dejavu-core fonts-dejavu-extra ghostscript gnuplot make latex-cjk-all latex-cjk-common latex-cjk-chinese latexmk lcdf-typetools lmodern poppler-utils psutils purifyeps python3-pygments t1utils tex-gyre tex4ht texlive-base texlive-bibtex-extra texlive-binaries texlive-extra-utils texlive-font-utils texlive-fonts-extra texlive-fonts-extra-links texlive-fonts-recommended texlive-formats-extra texlive-lang-all texlive-lang-chinese texlive-lang-cjk texlive-latex-base texlive-latex-extra texlive-latex-recommended texlive-luatex texlive-metapost texlive-pictures texlive-plain-generic texlive-pstricks texlive-publishers texlive-science texlive-xetex texlive-bibtex-extra && echo "Delete TeX Live sources and other useless stuff." && (rm -rf /usr/share/texmf/source || true) && (rm -rf /usr/share/texlive/texmf-dist/source || true) && find /usr/share/texlive -type f -name "readme*.*" -delete && find /usr/share/texlive -type f -name "README*.*" -delete && (rm -rf /usr/share/texlive/release-texlive.txt || true) && (rm -rf /usr/share/texlive/doc.html || true) && (rm -rf /usr/share/texlive/index.html || true) && echo "Update font cache." && fc-cache -fv && echo "Clean up all temporary files." && apt-get clean -y && rm -rf /var/lib/apt/lists/* && rm -f /etc/ssh/ssh_host_* && echo "Delete man pages and documentation." && rm -rf /usr/share/man && mkdir -p /usr/share/man && find /usr/share/doc -depth -type f ! -name copyright -delete && find /usr/share/doc -type f -name "*.pdf" -delete && find /usr/share/doc -type f -name "*.gz" -delete && find /usr/share/doc -type f -name "*.tex" -delete && (find /usr/share/doc -type d -empty -delete || true) && mkdir -p /usr/share/doc && rm -rf /var/cache/apt/archives && mkdir -p /var/cache/apt/archives && rm -rf /tmp/* /var/tmp/* && (find /usr/share/ -type f -empty -delete || true) && (find /usr/share/ -type d -empty -delete || true) && mkdir -p /usr/share/texmf/source && mkdir -p /usr/share/texlive/texmf-dist/source && echo "All done." # buildkit


CMD ["/bin/bash"]